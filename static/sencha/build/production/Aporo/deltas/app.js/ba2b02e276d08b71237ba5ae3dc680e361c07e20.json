["function _2123f17924de4b79f106c5ad82b6bef9966e4245",50,595395,595453,595,596377,672,596864,59,"ActiveDGBtn\",text:\"Active DG Menu",596862,61,"PassiveDGBtn\",text:\"Passive DG",597042,566,",\"button[itemId=ActiveDGBtn]\":{tap:\"onActiveDGMenuBtnTap\"},\"button[itemId=PassiveDGBtn]\":{tap:\"onPassiveDG",597596,751,",onActiveDGMenu",597629,144,"Active DG",598269,59,"ActiveDGMainView\"))},onPassiveDGMenu",597629,144,"Passive DG",598269,59,"PassiveDGMainView\")",599392,35,598380,739,"api_view",599119,1859,"api_view",600978,413,"controller.ActiveDG",598447,36,"ActiveDGMainView:\"ActiveDGMainView\",ActiveDGMenuView:\"ActiveDGMainView #ActiveDGMenuView\",ActiveDGCheckPackage:\"ActiveDGCheckPackage\"},control:{ActiveDGMainView:{activate:\"onActivate\"},\"ActiveDGMainView #btnCheckPackage\":{tap:\"onCheckPackage\"},\"ActiveDGMainView #btnUpdateRoute\":{tap:\"onUpdateRoute\"},\"ActiveDGMainView #btnCheckOut\":{tap:\"onCheckOut\"},\"ActiveDGCheckPackage #submitButton\":{tap:\"onCallInOrderSubmit\"}}},slideLeftTransition:{type:\"slide\",direction:\"left\"},slideRightTransition:{type:\"slide\",direction:\"right\"},device:null,locations:null,updateJSON:function(c){this.getActiveDGMainView().setMasked({xtype:\"loadmask\"});var a=this,b;b=function(d){a.postDeviceJSONUpdate(d,function(e){if(!e){a.back();Ext.Msg.alert(\"Error\",\"Something went wrong.\");return}a.showMenu()})};if(c){Ext.Ajax.request({url:\"Device.JSON\",useDefaultXhrHeader:false,success:function(e){var g=Ext.decode(e.responseText);var f=g[0],h=f.is_active==\"True\",i=Date.parse(f.last_updated),d=(Date.now()-i)>=parseInt(f.update_frequency);if(!h||d){a.updateDeviceJSON(g,function(k,j){b(j)})}},failure:function(d){console.log(\"failure\",d);a.back();Ext.Msg.alert(\"Error\",\"Something went wrong.\")}})}else{b(this.device)}},showMenu:function(){this.getActiveDGMainView().setMasked(false);var b=this.nextLocation(),a=this.getActiveDGMenuView().getComponent(\"toolbarHeader\");if(b){a.setTitle(this.titleForLocation(b))}},onActivate:function(){this.updateJSON(true)},back",600576,44,"CheckPackage:function(){console.log(\"# onCheckPackage\");var a=Ext.create(\"Aporo.view.ActiveDGCheckPackage\"),b=this.nextLocation();if(!b){Ext.Msg.alert(\"No location found!\");return}if(b.call_in==\"True\"",600399,69,"Check Package\");Ext.getCmp(\"Viewport\").push(a)}else{if(b.web==\"True\"){this.onWebOrder()}else{Ext.Msg.alert(\"Problem\",\"Next location was neither call_in or web\");return}}},onUpdateRoute:function(){console.log(\"# onUpdateRoute\");this.updateJSON(false)},onCheckOut:function(){console.log(\"# onCheckOut\");this.back()},onCallInOrderSubmit:function(){console.log(\"# onCallInOrderSubmit\");var b=this.getActiveDGCheckPackage().down(\"textfield\"),e=b.getValue();if(!e||e==\"\"){Ext.Msg.alert(\"Problem\",\"Please enter a tag\");return}var a=this.locationsWithProperties([{key:\"tag\",value:e},{key:\"end_datetime\",value:null},{key:\"pickup\",value:\"True\"}]);if(a.length>0){var c=a[0];c.end_datetime=this.formattedDate();console.log(c);Ext.Msg.alert(\"Success!\",null,function(){this.back()},this);return}a=this.locationsWithProperties([{key:\"tag\",value:e},{key:\"delivery\",value:\"True\"}]);if(a.length>0){var d=Ext.create(\"Aporo.view.ActiveDGCheckPackageModal\"),c=a[0];Ext.Viewport.add(d);Ext.getCmp(\"checkPackageModalSubmitButton\").on(\"tap\",function(){var f=Ext.getCmp(\"checkPackageModalPriceField\").getValue(),g=Ext.getCmp(\"checkPackageModalTipField\").getValue();d.destroy();c.price=f;c.tip=g;c.end_datetime=this.formattedDate();console.log(c);Ext.Msg.alert(\"Success!\",null,function(){this.back()},this)},this);return}Ext.Msg.show({title:\"Problem\",message:\"This order is not recognized\",promptConfig:false,buttons:[{text:\"Go back\",itemId:\"back\"},{text:\"Try again\",ui:\"action\",itemId:\"tryagain\"}],scope:this,fn:function(f){if(f==\"back\"){this.back()}}})},onWebOrder:function(){var a=function(e){var b=this.locationsWithProperties([{key:\"web_url\",value:e},{key:\"end_datetime\",value:null},{key:\"pickup\",value:\"True\"}]);if(b.length>0){var c=b[0];c.end_datetime=this.formattedDate();console.log(c);Ext.Msg.alert(\"Success!\");return}b=this.locationsWithProperties([{key:\"web_url\",value:e},{key:\"delivery\",value:\"True\"}]);if(b.length>0){var d=Ext.create(\"Aporo.view.ActiveDGCheckPackageModal\"),c=b[0];Ext.Viewport.add(d);Ext.getCmp(\"checkPackageModalSubmitButton\").on(\"tap\",function(){var f=Ext.getCmp(\"checkPackageModalPriceField\").getValue(),g=Ext.getCmp(\"checkPackageModalTipField\").getValue();d.destroy();c.price=f;c.tip=g;c.end_datetime=this.formattedDate();console.log(c);Ext.Msg.alert(\"Success!\")},this);return}Ext.Msg.show({title:\"Problem\",message:\"This order is not recognized\",promptConfig:false,buttons:[{text:\"Cancel\",itemId:\"back\"},{text:\"Try again\",ui:\"action\",itemId:\"tryagain\"}],scope:this,fn:function(f){if(f==\"tryagain\"){var g=this;setTimeout(function(){g.onWebOrder()},500)}}})};a.call(this,\"url\")},updateDeviceJSON:function(b,c){console.log(\"# updateDeviceJSON\");var a=Ext.clone(b);a[0][\"is_active\"]=\"True\";console.log(a);this.device=a;c(true,b)},postDeviceJSONUpdate:function(a,d){console.log(\"# postDeviceJSONUpdate\");var c=this,b=Ext.clone(a[0]);delete b.is_active;delete b.update_frequency",600926,52,"api/device/\"",599182,52,"encode({action:\"update\",currier_id:Aporo.app.globals.currier_id,device:b,is_active:a[0][\"is_active\"],update_frequency:a[0][\"update_frequency\"]}),success:function(g){var f=Ext.decode(g.responseText)[0],h=f.Device,e=f[\"Locations.JSON\"];a=Ext.Object.merge(a,h);c.updateDeviceJSON(a,function(){c.updateLocationsJSON(e,function(){d(true)})})},failure:function(e){d(false)}})},updateLocationsJSON:function(a,b){console.log(\"# updateLocationsJSON\");console.log(a);this.locations=a;b(true)},formattedDate:function(){function a(c){function b(d){return d<10?\"0\"+d:d}return c.getUTCFullYear()+\"-\"+b(c.getUTCMonth()+1)+\"-\"+b(c.getUTCDate())+\"T\"+b(c.getUTCHours())+\":\"+b(c.getUTCMinutes())+\":\"+b(c.getUTCSeconds())+\"Z\"}return a(new Date())},nextLocation:function(){var c=null;if(!this.locations){return c}for(var a=0;a<this.locations.length;a++){var b=this.locations[a][\"end_datetime\"];if(!b||b==\"\"){if(c){if(parseInt(c.loc_num)>parseInt(this.locations[a][\"loc_num\"])){c=this.locations[a]}}else{c=this.locations[a]}}}return c},locationsForTag:function(b){var a=[];if(!this.locations){return a}for(var c=0;c<this.locations.length;c++){if(this.locations[c][\"tag\"]==b){a.push(this.locations[c])}}return a},locationsWithProperties:function(e){var a=[];if(!this.locations){return a}for(var d=0;d<this.locations.length;d++){var f=true;for(var b=0;b<e.length;b++){var c=e[b][\"key\"],g=e[b][\"value\"];if(!g){if(this.locations[d][c]&&this.locations[d][c]!=\"\"){f=false}}else{if(this.locations[d][c]!=g){f=false}}}if(f){a.push(this.locations[d]);break}}return a},titleForLocation:function(a){var b=null;if(a.addr){b=a.addr}if(a.cross_street){b=(b&&b.length>0)?b+\", \"+a.cross_street:a.cross_street}if(a.tag){b=(b&&b.length>0)?b+\", \"+a.tag:a.tag}return b",598346,34,"ActiveDG",599439,41,"PassiveDG",598447,36,"PassiveDGMainView:\"PassiveDGMainView\",PassiveDGMenuView:\"PassiveDGMenuView\"},control:{PassiveDGMainView:{activate:\"onActivate\"},\"PassiveDGMainView #findWorkButton\":{tap:\"onFindWork\"},\"PassiveDGMainView #checkInNowButton\":{tap:\"onCheckInNow\"},\"PassiveDGMainView #btnContracts\":{tap:\"onContracts\"},\"PassiveDGMainView #btnCheckIn\":{tap:\"onCheckIn\"},\"PassiveDGMainView #btnHistory\":{tap:\"onHistory\"}}},slideLeftTransition:{type:\"slide\",direction:\"left\"},slideRightTransition:{type:\"slide\",direction:\"right\"},work:null,onActivate:function(){console.log(\"# onActivate\");this.getWorkJSON();this.getPassiveDGMainView().setMasked({xtype:\"loadmask\"})},back",600576,44,"FindWork:function(){this.back()},onCheckInNow:function(){Ext.Msg.confirm(\"Are you sure?\",\"Are you sure you want to check-in now?\",function(a){if(a==\"yes\"){this.back()}},this)},onContracts:function(){this.back()},onCheckIn:function(){this.back()},onHistory:function(){this.back()},getWorkJSON:function(){console.log(\"# getWorkJSON\");var a=this",600926,52,"api/work/",596178,41,"params:Ext.encode({action:\"GET\",currier_id:Aporo.app.globals.currier_id}),success:function(b){var c=Ext.decode(b.responseText);a.updateWorkJSON(c);a.getPassiveDGMainView().setMasked(false)},failure:function(b){console.log(\"failure\",b);a.back()}})},updateWorkJSON:function(a){console.log(\"# updateWorkJSON\",a);this.work=a;this.updateHeader()},updateHeader:function(){var i=this.nextWork(),h=Ext.getCmp(\"PassiveDGMenuView\"),d=h.getComponent(\"header\"),a=h.getComponent(\"findWorkButton\"),c=h.getComponent(\"checkInNowButton\");if(this.hasWork()){a.hide();c.hide();var f=Date.parse(i.start_datetime);if(Date.now()>=(f-900000)){d.hide();c.show();return}else{var g=new Date(),b=new Date(Date.parse(i.start_datetime)),e=g.toDateString()==b.toDateString();d.setHtml([\"Next Check In:\",e?\"TODAY\":i.start_day,i.start_time,i.area].join(\"<br />\"))}}else{d.hide();c.hide();a.show()}},nextWork:function(){var b=null;if(!this.work||!this.work.dg_schedule||this.work.dg_schedule.length==0){return b}var d=this.work.dg_schedule;for(var a=0;a<d.length;a++){var c=d[a][\"check_in_datetime\"];if(!c||c==\"\"||c==\"null\"){if(b){if(Date.parse(b.start_datetime)>Date.parse(d[a][\"start_datetime\"])){b=d[a]}}else{b=d[a]}}}return b},hasWork:function(){return this.work&&this.work.dg_schedule&&this.work.dg_schedule.length>0",598346,34,"PassiveDG",596018,234,"api_view",596252,130,601396,4799,"(Ext.cmd.derive(\"Aporo.view.ActiveDGMenuView",603487,33,"card\",scrollable:null,items:[{xtype:\"toolbar\",docked:\"top\",itemId:\"toolbarHeader\"},{flex:1,layout:{pack:\"center\",type:\"vbox\"},items:[{xtype:\"button\",text:\"Check Package\",itemId:\"btnCheckPackage\",ui:\"action\",margin:\"2% 15% 0 15%\"},{xtype:\"button\",text:\"Update Route\",itemId:\"btnUpdateRoute\",ui:\"action\",margin:\"2% 15% 0 15%\"},{xtype:\"button\",text:\"Check-out\",itemId:\"btnCheckOut\",ui:\"action\",margin:\"2% 15% 0 15%\"}]}]}},0,[\"ActiveDGMenuView\"],[\"ActiveDGMenuView\",\"component\",\"container\"],{ActiveDGMenu",603311,39,"},[\"widget.ActiveDGMenuView\"],0,[Aporo.view,\"ActiveDGMenu",603433,39,"ActiveDGMainView\",Ext.Container,{id:\"ActiveDGMainView\",config:{layout:\"card\",items:[{itemId:\"ActiveDGMenuView\",xtype:\"ActiveDGMenuView\",flex:1}]}},0,[\"ActiveDGMainView\"],[\"ActiveDGMainView\",\"component\",\"container\"],{ActiveDGMai",603310,40,"},[\"widget.ActiveDGMainView\"],0,[Aporo.view,\"ActiveDGMai",603432,40,"ActiveDGCheckPackage\",Ext.Container,{id:\"ActiveDGCheckPackage\",config:{layout:\"card\",scrollable:null,items:[{xtype:\"formpanel\",items:[{xtype:\"textfield\",label:\"Tag\",itemId:\"tagField\"},{xtype:\"titlebar\",docked:\"bottom",605769,39,"align:\"right\",itemId:\"submitButton\"}]}]}]}},0,[\"ActiveDGCheckPackage\"],[\"ActiveDGCheckPackage\",\"component\",\"container\"],{ActiveDGCheckPackage",604763,46,"ActiveDGCheckPackage\"],0,[Aporo.view,\"ActiveDGCheckPackage",601821,35,"ActiveDGCheckPackageModal\",Ext.Panel,{id:\"ActiveDGCheckPackageModal\",config:{scrollable:null,modal:true,centered:true,items:[{xtype:\"fieldset\",items:[{xtype:\"textfield\",label:\"Price\",id:\"checkPackageModalPriceField\"},{xtype:\"textfield\",label:\"Tip\",id:\"checkPackageModalTipField\"}]},",570305,32,605770,38,"id:\"checkPackageModalSubmitButton\"}]}]}},0,[\"ActiveDGCheckPackageModal\"],[\"ActiveDGCheckPackageModal\",",278050,34,"ActiveDGCheckPackageModal",604763,35,",panel:true},[\"widget.ActiveDGCheckPackageModal\"],0,[Aporo.view,\"ActiveDGCheckPackageModal",601821,35,"PassiveDGMenuView\",Ext.Container,{id:\"PassiveDGMenuView\",config:{layout:\"card\",scrollable:null,items:[{xtype:\"container\",docked:\"top\",itemId:\"header\",margin:\"2% 15% 0 15%\"},{xtype:\"button\",docked:\"top\",text:\"Find Work Now!\",itemId:\"findWorkButton\",margin:\"2% 15% 0 15%\"},{xtype:\"button\",docked:\"top\",text:\"Check In Now\",itemId:\"checkInNowButton\",margin:\"2% 15% 0 15%\"},{flex:1,layout:{pack:\"center\",type:\"vbox\"},items:[{xtype:\"button\",text:\"Contracts\",itemId:\"btnContracts\",ui:\"action\",margin:\"2% 15% 0 15%\"},{xtype:\"button\",text:\"Check-in\",itemId:\"btnCheckIn\",ui:\"action\",margin:\"2% 15% 0 15%\"},{xtype:\"button\",text:\"History\",itemId:\"btnHistory\",ui:\"action\",margin:\"2% 15% 0 15%\"}]}]}},0,[\"PassiveDGMenuView\"],[\"PassiveDGMenuView\",\"component\",\"container\"],{PassiveDGMenu",603311,39,"},[\"widget.PassiveDGMenuView\"],0,[Aporo.view,\"PassiveDGMenu",603433,39,"PassiveDGMainView\",Ext.Container,{id:\"PassiveDGMainView\",config:{layout:\"card\",items:[{id:\"PassiveDGMenuView\",itemId:\"PassiveDGMenuView\",xtype:\"PassiveDGMenuView\",flex:1}]}},0,[\"PassiveDGMainView\"],[\"PassiveDGMainView\",\"component\",\"container\"],{PassiveDGMai",603310,40,"},[\"widget.PassiveDGMainView\"],0,[Aporo.view,\"PassiveDGMainView",606188,203,",\"ActiveDGMainView\",\"ActiveDGMenuView\",\"ActiveDGCheckPackage\",\"ActiveDGCheckPackageModal\",\"PassiveDGMainView\",\"PassiveDGMenuView",606390,57,",\"ActiveDG\",\"PassiveDG",606446,548,"globals:{app_user:1,currier_id:1,is_active:false",606992,314]