["function _fca48c0ed0b23edc6844430b3eacd3c681de5831",50,175,"util){Aporo.util",211,34,"if(!Aporo.view.activeDG){Aporo.view.activeDG={}}if(!Aporo.view.passiveDG){Aporo.view.passiveDG",241,972,"grid){Ext.grid={}}if(!Ext.grid.column){Ext.grid.column={}}if(!Ext.grid.infinite){Ext.grid.infinite",1201,496,"ux){Ext.ux",1685,27416,"Ext.setVersion(\"sencha-touch-grid\",\"2.3.0\")",29100,566257,"Ext.grid.infinite.Row",298560,52,"grid-row\",index:0,columns:null,renderedCellCount:null,columnPositionMap:null,minimumBufferDistance:3,bufferSize:12},leftRenderedIndex:0,leftVisibleIndex:0,constructor:function(){this.cells=[];this.updatedCells=[];this.offsets={};this.widths={}",540964,58,"},createCell:function(){var b=this.self.prototype,a,f,d,c,e;if(!b.hasOwnProperty(\"cellRenderTemplate\")){b.cellRenderTemplate=a",124752,35,487936,41,"CellElementConfig(),true));f=a.querySelectorAll(\"[id]\"",215315,39,"removeAttribute(\"id\")}}return b.cellRenderTemplate.cloneNode(true).firstChild},getCellElementConfig:function(){var a={tag:\"div\",cls:Ext.baseCSSPrefix+\"grid-cell\"};return a},onTranslate:function(a){var b=this;if(b.cells.length){b.handleCellUpdates(a);b.handleCellDimensions()}},handleCellUpdates:function(o){var t=this,d=t.getColumnPositionMap(),g=t.cells,m=g.length,c=t.getColumns(),s=c.length-1,k=t.getBufferSize(),f=t.getRecord(),p=t.getIndex(),j=t.getMinimumBufferDistance(),u=t.leftVisibleIndex,l=t.leftRenderedIndex,q,a,h,n,b,r,e;t.leftVisibleIndex=q=Math.max(0,d.findIndex(-o)||0);if(u!==q){if(u>q){a=q-l;if(a<j){h=Math.min(m,j-a);for(r=0;r<h;r++){n=l-r-1;if(n<0){break}b=g.pop();g.unshift(b);e=c[n];t.updateCell(b,e,f,p);t.updatedCells.push(b);t.leftRenderedIndex--}}}else{a=l+k-q;if(a<j){h=Math.min(m,j-a);for(r=0;r<h;r++){n=l+m+r;if(n>s){break}b=g.shift();g.push(b);e=c[n];t.updateCell(b,e,f,p);t.updatedCells.push(b);t.leftRenderedIndex++}}}}},handleCellDimensions:function(){var i=this,k=i.cells,d=i.widths,e=i.offsets,g=i.updatedCells,l=i.getColumnPositionMap(),a=i.leftRenderedIndex,b,f,j,c,h;while(j=g.shift()){h=k.indexOf(j);c=Ext.get(j);b=l.getItemHeight(h+a);f=l.map[h+a];if(b!==d[j.id]){c.setWidth(b);d[j.id]=b}if(f!==e[j.id]){c.translate(f);e[j.id]=f}}},updateRenderedCellCount:function(g){var f=this,e=f.element,k=f.cells,j=k.length,a=f.getBufferSize(),c=g+a,b=c-j,d,h;for(d=0;d<b;d++){h=f.createCell(j+d);e.appendChild(h);k.push(h);f.updatedCells.push(h)}for(d=b;d<0;d++){e.removeChild(k.pop())}},updateRecord:function(e){var h=this,f=h.getIndex(),c=h.getColumns(),k=h.cells,a=h.leftRenderedIndex,d,g,j,b;for(d=0,g=k.length;d<g;d++){j=k[d];b=c[d+a];h.updateCell(j,b,e,f)}},updateCell:function(a,d,b,c){var e=this;b=b||e.getRecord();c=c||e.getIndex();a.innerHTML=b&&d?d.getCellContent(b,e,c):\"\"}},1,[\"gridrow\"],[\"component\",\"gridrow\"],{component:true,gridrow:true},[\"widget.gridrow\"],0,[Ext.grid.infinite,\"Row\"],0));(Ext.cmd.derive(\"Ext.grid.Row",298560,52,"grid-row\",grid",322527,35,"cells=[];this.columnMap={}",540964,58,"},updateGrid:function(c){var e=this,b,a,d;e.element.innerHTML=\"\";e.cells=[];if(c){a=c.getColumns();for(b=0,d=a.length;b<d;b++){e.addColumn(a[b])}}},addColumn:function(a){this.insertColumn(this.cells.length,a)},insertColumn:function(h,c){if(this.getCellByColumn(c)){return}var i=this,e=i.element,l=i.cells,g=i.columnMap,j=i.createCell(h),d=i.cells[h],a=c.getCellCls(),b=Ext.get(j),f=this.getRecord(),k=[];j.$column=c;j.style.width=c.getWidth()+\"px\";if(c.isHidden()){j.style.display=\"none\"}k.push(Ext.baseCSSPrefix+\"grid-cell-align-\"+c.getAlign());if(a){k.push(a)}b.addCls(k);if(f){c.updateCell(j,f)}if(d){e.dom.insertBefore(j,d);l.splice(h,0,j)}else{e.dom.appendChild(j);l.push(j)}g[c.getId()]=j},removeColumn:function(d){var e=this,b=e.columnMap,c=e.element,f=d.getId(),a=b[f];delete a.$column;if(a){c.removeChild(a)}Ext.Array.remove(e.cells,a);delete b[f]},updateRecord:function(b){var g=this,c=g.cells,d,f,a,e;for(d=0,f=c.length;d<f;d++){a=c[d];e=g.getColumnByCell(a);e.updateCell(a,b)}},setColumnWidth:function(c,b){var a=this.getCellByColumn(c);if(a){a.style.width=b+\"px\"}},showColumn:function(b){var a=this.getCellByColumn(b);if(a){a.style.display=\"\"}},hideColumn:function(b){var a=this.getCellByColumn(b);if(a){a.style.display=\"none\"}},getCellByColumn:function(a){return this.columnMap[a.getId()]},getColumnByCell:function(a){return a.$column},createCell:function(){var b=this.self.prototype,a,f,d,c,e;if(!b.hasOwnProperty(\"cellRenderTemplate\")){b.cellRenderTemplate=a",124752,35,487936,41,"CellElementConfig(),true));f=a.querySelectorAll(\"[id]\"",215315,39,"removeAttribute(\"id\")}}return b.cellRenderTemplate.cloneNode(true).firstChild},getCellElementConfig:function(){var a={tag:\"div\",cls:Ext.baseCSSPrefix+\"grid-cell\",html:\"&nbsp;\"};return a}},1,[\"gridrow\"],[\"component\",\"gridrow\"],{component:true,gridrow:true},[\"widget.gridrow\"],0,[Ext.grid,\"Row\"],0));(Ext.cmd.derive(\"Ext.grid.column.Column\",Ext.Component,{config:{dataIndex:null,text:\"&nbsp;\",sortable:true,resizable:true,hideable:true,renderer:false,scope:null,align:\"left\",editable:false,editor:null,defaultEditor:{xtype:\"textfield\",required:true},ignore:false,summaryType:null,summaryRenderer:null,minWidth:20,baseCls:Ext.baseCSSPrefix+\"grid-column\",cellCls:null,sortedCls:Ext.baseCSSPrefix+\"column-sorted\",sortDirection:null},updateAlign",429561,36,"Ext.baseCSSPrefix+\"grid-column-align-\"+b)}if(b",312888,33,"grid-column-align-\"+b",446334,77,"element.on({tap:\"onColumnTap\",longpress:\"onColumnLongPress\",scope:this})},onColum",306628,33,"tap\",this,a)},onColumnLongPress:function(a){this.fireEvent(\"longpress\",this,a)},updateText:function(a){this.setHtml(a)},doSetWidth",304973,42,"Width.apply(this,arguments);this.fireEvent(\"columnresize\",this,a)},updateDataIndex:function(a){var b=this.getEditor();if(b){b.name=a}else{this.getDefaultEditor().name=a}},updateSortDirection:function(c,a){if(!this.getSortable()){return}var b=this.getSortedCls();if(a){this.element.removeCls(b+\"-\"+a.toLowerCase())}if(c){this.element.addCls(b+\"-\"+c.toLowerCase())}this.fireEvent(\"sort\",this,c,a)},getCellContent:function(a){var d=this,b=d.getDataIndex(),f=d.getRenderer(),c=d.getScope(),e=b&&a.get(b);return f?f.call(c||d,e,a,b):d.defaultRenderer(e,a)},defaultRenderer:function(a){return a},updateCell:function(a,b,c){if(a&&(b||c)){a.firstChild.nodeValue=c||this.getCellContent(b)}}},0,[\"column\"],[\"column\",\"component\"],{colum",281781,32,"column\"],0,[Ext.grid.column,\"Column\"],0));(Ext.cmd.derive(\"Ext.grid.infinite.Grid\",Ext.Container,{config:{columns:null,",437104,48,"grid",437160,37,"loadingText:\"Loading...\",variableHeights:false,layout:\"fit\",defaultType:\"gridrow\",rowCls:null,selectedCls:Ext.baseCSSPrefix+\"row-selected\",minimumRowHeight:30,bufferSize:10,minimumBufferDistance:3",437832,161,"hasLoadedStore:false,",592254,33,";a",437600,37,"a,arguments",322591,61,282256,32,"c=this,a,d,b;Ext.apply(c,{rows:[],offsets:{},updatedRows:[",452622,39,"currentX:null,currentY:null,rowPositionMap:Ext.create(\"Ext.util.PositionMap\",{minimumHeight:c.getMinimumRowHeight()}),columnPositionMap:Ext.create(\"Ext.util.PositionMap\",{minimumHeight:20})",452942,84,"a=c",453036,76,"false,direction:\"both\"}}});c.add(a",453972,49,"c});d=a.getScrollable();b=c.scrollViewElement=d.getElement();c.scrollElement=d.getScroller().getElement();c.setScrollable(d);c.scrollableBehavior=a.getScrollableBehavior();c.bind(d",453579,63,164792,32,"var c=this;c.visibleRowCount=Math.ceil(b.height/c.getMinimumRowHeight());c.visibleColumnCount=this.determineMaxVisibleColumnCount(b.width);c.containerHeight=b.height;c.setRenderedRowCount(c.visibleRowCount+1)},onTranslate:function(a,h){var e=this,b=e.getStore(),g=b&&b.getCount(),f=e.rows,c,d;if(!g){e.showEmptyText()}else{if(e.rowCount){if(h!==e.currentY){e.handleRowUpdates(h)}if(a!==e.currentX){for(c=0,d=f.length;c<d;c++){f[c].onTranslate(a)}e.currentX=a}if(h!==e.currentY){e.handleRowTransforms();e.currentY=h}}}},handleRowUpdates:function(l){var j=this,q=j.rowPositionMap,r=j.rows,m=r.length,o=j.getStore(),f=o.getCount()-1,a=j.getBufferSize(),n=j.getMinimumBufferDistance(),b=j.topVisibleIndex,e=j.topRenderedIndex,h,g,d,k,p,c;j.topVisibleIndex=h=Math.max(0,q.findIndex(-l)||0);if(b!==h){if(b>h){g=h-e;if(g<n){d=Math.min(m,n-g);for(c=0;c<d;c++){k=e-c-1;if(k<0){break}p=r.pop();r.unshift(p);j.updateRow(p,k);j.topRenderedIndex--}}}else{g=e+a-h;if(g<n){d=Math.min(m,n-g);for(c=0;c<d;c++){k=e+m+c;if(k>f){break}p=r.shift();r.push(p);j.updateRow(p,k);j.topRenderedIndex++}}}}},handleRowTransforms:function(){var b=this,a=b.offsets,f=b.updatedRows,c=b.rowPositionMap,e,d;while(d=f.shift()){e=c.map[d.getIndex()];if(e!==a[d.id]){d.translate(0,e);a[d.id]=e}}},applyColumns:function(b){var a,d,c;if(b){if(!Ext.isArray(b)){b=[b]}for(a=0,d=b.length;a<d;a++){c=b[a];if(!c.isComponent){c=Ext.factory(c,Ext.grid.column.Column);b[a]=c}}}return b},updateColumns:function(b){if(b&&b.length){var e=this,d=b.length,a,c;e.columnPositionMap.populate(d);for(a=0;a<d;a++){c=b[a];e.columnPositionMap.setItemHeight(a,c.getWidth())}e.columnPositionMap.update();e.scrollElement.setWidth(e.columnPositionMap.getTotalHeight())}},determineMaxVisibleColumnCount:function(a){var h=this,k=h.columnPositionMap,c=0,f,b,e,d,g;for(e=0,g=k.map.length;e<g;e++){f=b=0;d=e;while(b<a&&d<g){b+=k.getItemHeight(d);f++;d++}if(f>c){c=f}}return c},setRenderedRow",458837,33,"rows,b=d.getRowConfig(),f=a+d.getBufferSize()",458907,37,"Row",458948,41,"rowCount=a;d.updateAllRows();return d.rows},getRowConfig:function(){var a=this;return{xtype:a.getDefaultType(),minHeight:a.rowPositionMap.getMinimumHeight(),columns:a.getColumns(),cls:a.getRowCls(),columnPositionMap:a.columnPositionMap",235312,33,"this.translationMethod}}},createRow:function(b){var c=this,a=c.container,d=c.rows,e;e=Ext.factory(b);e.grid=c;e.$height=b.minHeight;a.doAdd(e);d.push(e);return e},updateAllRows:function(){var d=this,e=d.rows,a=d.getStore(),f=d.topRenderedIndex,b,c;if(d.hasLoadedStore){for(b=0,c=e.length;b<c;b++){d.updateRow(e[b],f+b)}if(a.getCount()){d.scrollElement.setHeight(d.rowPositionMap.getTotalHeight())}else{d.scrollElement.setHeight(d.containerHeight)}}d.refreshScroller()},updateRow:function(m,e){var h=this,l=h.getStore(),c=l.getAt(e),j=h.updatedRows,d=h.getSelectedCls(),a=[],g=[d],k=m.renderElement.classList,b,f;m.$position=-10000;if(!c){m.setRecord(null);m.translate(0,-10000);m.$hidden=true;return}else{if(m.$hidden){m.$hidden=false}}j.push(m);m.setIndex(e);m.setRenderedCellCount(h.visibleColumnCount);if(m.getRecord()===c){m.updateRecord(c)}else{m.setRecord(c)}if(h.isSelected(c)){a.push(d)}if(k){for(b=0,f=g.length;b<f;b++){Ext.Array.remove(k,g[b])}a=Ext.Array.merge(a,k)}m.renderElement.setCls(a)",462698,58,462832,54,443204,181,"doRefresh:function(){var b=this,c=b.rows,a=b.getStore(),d=a.getCount();b.rowPositionMap",461885,34,";if(c.length){if(d){b.hideEmptyText()}b.updateAllRows()",442657,152,441813,780,";d.refresh()",442593,36,"}",442801,403,464479,106,"){this.doRefresh()},onStoreClear:function(){this.doRefresh()",444351,203,"},1,[\"grid\"],[\"component\",\"container\",\"grid",278080,34,"grid:true},[\"widget.grid",445405,98,",",470935,95,"grid.infinite,\"Grid\"],0));(Ext.cmd.derive(\"Ext.grid.column.CheckColumn\",Ext.grid.column.Column,{alternateClassName:\"Ext.ux.CheckColumn\",align:\"center\",stopSelection:true,tdCls:Ext.baseCSSPrefix+\"grid-cell-checkcolumn\",constructor:function(){this.addEvents(\"beforecheckchange\",\"checkchange\");this.scope",540959,63,"},processEvent:function(g,i,m,b,h,d,c,n){var f=this,l=g===\"keydown\"&&d.getKey(),a=g==\"mousedown\";if(!f.disabled&&(a||(l==d.ENTER||l==d.SPACE))){var j=f.dataIndex,k=!c.get(j);if(f.fireEvent(\"beforecheckchange\",f,b,k)!==false){c.set(j,k);f.fireEvent(\"checkchange\",f,b,k);if(a){d.stopEvent()}if(!f.stopSelection){i.selModel.selectByPosition({row:b,column:h})}return false}else{return !f.stopSelection}}else{return f.callParent(arguments)}},onEnable:function(a){var b=this;b.callParent(arguments);b.up(\"tablepanel\").el.select(\".\"+Ext.baseCSSPrefix+\"grid-cell-\"+b.id).removeCls(b.disabledCls);if(!a){b.fireEvent(\"enable\",b)}},onDisable:function(a){var b=this;b.callParent(arguments);b.up(\"tablepanel\").el.select(\".\"+Ext.baseCSSPrefix+\"grid-cell-\"+b.id).addCls(b.disabledCls);if(!a){b.fireEvent(\"disable\",b)}},renderer:function(b,c){var d=Ext.baseCSSPrefix,a=[d+\"grid-checkcolumn\"];if(this.disabled){c.tdCls+=\" \"+this.disabledCls}if(b){a.push(d+\"grid-checkcolumn-checked\")}return'<img class=\"'+a.join(\" \")+'\" src=\"'+Ext.BLANK_IMAGE_URL+'\"/>'}},1,[\"checkcolumn\"],[\"checkcolumn\",\"column\",\"component\"],{checkcolumn:true,colum",281781,32,"checkcolumn\"],0,[Ext.grid.column,\"CheckColumn\",Ext.ux,\"CheckColum",599438,34,"fig.Env\",Ext.Base,{statics:{app_user:1,currier_id:1,is_active:false,",595394,51,"\",django_token:typeof Aporo==\"undefined\"?null",595467,79,"util.PhoneGap\",Ext.Evented,{statics:{saveFile:function(a){if(!Ext.browser.is.PhoneGap){return}if(typeof a.data!=\"String\"){a.data=Ext.encode(a.data)}window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(b){b.root.getFile(a.fileName,{create:true,exclusive:false},function(c){c.createWriter(function(d){d.write(a.data);a.success()},a.failure)},a.failure)},a.failure)},readFile:function(a){if(!Ext.browser.is.PhoneGap){return}window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(b){b.root.getFile(a.fileName,{create:true,exclusive:false},function(c){c.file(function(e){var d=new FileReader();d.onloadend=function(g){var f=g.target.result;if(f){a.success(a.format==\"json\"?Ext.decode(f):f)}else{a.success(null)}};d.readAsText(e)},a.failure)},a.failure)},a.failure)},fileExists:function(a){if(!Ext.browser.is.PhoneGap){return}this.readFile({fileName:a.fileName,success:function(b){a.success(b?true:false)},failure:a.failure})}}},0,0,0,0,0,0,[Aporo.util,\"PhoneGap",595516,532,596377,672,596864,59,"ActiveDGBtn\",text:\"Active DG Menu",596862,61,"PassiveDGBtn\",text:\"Passive DG",597042,256,"platformConfig:{},",597298,310,",\"button[itemId=ActiveDGBtn]\":{tap:\"onActiveDGMenuBtnTap\"},\"button[itemId=PassiveDGBtn]\":{tap:\"onPassiveDG",597596,751,",onActiveDGMenu",597629,144,"Active DG",598269,59,"activeDG.MainView\"))},onPassiveDGMenu",597629,144,"Passive DG",598269,59,"passiveDG.MainView\")",599392,35,598380,739,"api_view",599119,1859,"api_view",600978,413,"controller.ActiveDG",598447,36,"ActiveDGMainView:\"ActiveDGMainView\",ActiveDGMenuView:\"ActiveDGMainView #ActiveDGMenuView\",ActiveDGCheckPackage:\"ActiveDGCheckPackage\"},control:{ActiveDGMainView:{activate:\"onActivate\"},\"ActiveDGMainView #btnCheckPackage\":{tap:\"onCheckPackage\"},\"ActiveDGMainView #btnUpdateRoute\":{tap:\"onUpdateRoute\"},\"ActiveDGMainView #btnCheckOut\":{tap:\"onCheckOut\"},\"ActiveDGCheckPackage #submitButton\":{tap:\"onCallInOrderSubmit\"}}},slideLeftTransition:{type:\"slide\",direction:\"left\"},slideRightTransition:{type:\"slide\",direction:\"right\"},device:null,locations:null,updateJSON:function(d){this.getActiveDGMainView().setMasked({xtype:\"loadmask\"});var b=this,c;c=function(e){b.postDeviceJSONUpdate(e,function(f){if(!f){b.back();Ext.Msg.alert(\"Error\",\"Something went wrong.\");return}b.showMenu()})};if(d){var a=function(e){b.back();if(e){Ext.Msg.alert(\"Error\",\"There was a problem:<br /><br />\"+e.code)}else{Ext.Msg.alert(\"Error\",\"Something went wrong. Please try again.\")}};Aporo.util.PhoneGap.fileExists({fileName:\"Device.JSON\",success:function(e){if(e){b.readDeviceJSON({success:function(h){var g=h[0],i=g.is_active==\"True\",j=Date.parse(g.last_updated),f=(Date.now()-j)>=parseInt(g.update_frequency);if(!i||f){b.updateDeviceJSON(h,function(l,k){c(k)})}},failure:a})}else{b.updateDeviceJSON(null,function(g,f){c(f)})}},failure:a})}else{c(this.device)}},readDeviceJSON:function(a){Aporo.util.PhoneGap.readFile({fileName:\"device.JSON\",success:function(b){a.success(b)},failure:function(b){a.failure(b)}})},updateDeviceJSON:function(b,d){console.log(\"# updateDeviceJSON\");var c=this;if(b){b=Ext.clone(b)}else{b=c.json||[{}]}b[0][\"is_active\"]=\"True\";var a=function(){c.device=b;d(true,b)};if(Ext.browser.is.PhoneGap){b[0][\"model\"]=device.model;b[0][\"platform\"]=device.platform;b[0][\"uuid\"]=device.uuid;b[0][\"op_sys_ver\"]=device.version;navigator.geolocation.getCurrentPosition(function(e){b[0][\"lat\"]=e.coords.latitude;b[0][\"long\"]=e.coords.longitude;b[0][\"coord_accuracy\"]=e.coords.accuracy;b[0][\"heading\"]=e.coords.heading;b[0][\"speed\"]=e.coords.speed;a.call(c)},function(e){console.log(\"Error fetching geolocation position:\",e);a.call(c)})}else{a()}},postDeviceJSONUpdate:function(a,d){console.log(\"# postDeviceJSONUpdate\");var c=this,b=Ext.clone(a[0]);delete b.is_active;delete b.update_frequency",600926,52,"api/device/\"",599182,52,"encode({action:\"update\",currier_id:Aporo.config.Env.currier_id,device:b,is_active:a[0][\"is_active\"],update_frequency:a[0][\"update_frequency\"]}),success:function(g){var f=Ext.decode(g.responseText)[0],h=f[\"Device.JSON\"],e=f[\"Locations.JSON\"];a=Ext.Object.merge(a,h);c.updateDeviceJSON(a,function(){c.updateLocationsJSON(e,function(){d(true)})})},failure:function(e){d(false)}})},updateLocationsJSON:function(a,b){console.log(\"# updateLocationsJSON\");this.locations=a;console.log(a);Aporo.util.PhoneGap.saveFile({fileName:\"Locations.JSON\",data:a,success:function(){console.log(\"Locations.JSON saved\");b(true)},failure:function(c){Ext.Msg.alert(\"Error saving Locations.JSON\",c.code);b(false)}})},showMenu:function(){this.getActiveDGMainView().setMasked(false);var b=this.nextLocation(),a=this.getActiveDGMenuView().getComponent(\"toolbarHeader\");if(b){a.setTitle(this.titleForLocation(b))}},onActivate:function(){this.updateJSON(true)},back",600576,44,"CheckPackage:function(){console.log(\"# onCheckPackage\");var a=Ext.create(\"Aporo.view.activeDG.CheckPackage\"),b=this.nextLocation();if(!b){Ext.Msg.alert(\"No location found!\");return}if(b.call_in===true||b.call_in===\"True\"",600399,69,"Check Package\");Ext.getCmp(\"Viewport\").push(a)}else{if(b.web===true||b.web===\"True\"){this.onWebOrder()}else{Ext.Msg.alert(\"Problem\",\"Next location was neither call_in or web\");return}}},onUpdateRoute:function(){console.log(\"# onUpdateRoute\");this.updateJSON(false)},onCheckOut:function(){console.log(\"# onCheckOut\");this.back()},onCallInOrderSubmit:function(){console.log(\"# onCallInOrderSubmit\");var e=this;var b=e.getActiveDGCheckPackage().down(\"textfield\"),f=b.getValue();if(!f||f==\"\"){Ext.Msg.alert(\"Problem\",\"Please enter a tag\");return}var a=e.locationsWithProperties([{key:\"tag\",value:f},{key:\"end_datetime\",value:null},{key:\"pickup\",value:\"True\"}]);if(a.length>0){e.updateDeviceJSON(e.json,function(i,h){var g=a[0];g.end_datetime=e.formattedDate();e.updateLocationsJSON(e.locations,function(j){Ext.Msg.alert(\"Success!\",null,function(){e.back()},e)})});return}a=e.locationsWithProperties([{key:\"tag\",value:f},{key:\"delivery\",value:\"True\"}]);if(a.length>0){var d=Ext.create(\"Aporo.view.activeDG.CheckPackageModal\"),c=a[0];Ext.Viewport.add(d);Ext.getCmp(\"checkPackageModalSubmitButton\").on(\"tap\",function(){var g=Ext.getCmp(\"checkPackageModalPriceField\").getValue(),h=Ext.getCmp(\"checkPackageModalTipField\").getValue();d.destroy();e.updateDeviceJSON(e.json,function(j,i){c.price=g;c.tip=h;c.end_datetime=e.formattedDate();e.updateLocationsJSON(e.locations,function(k){Ext.Msg.alert(\"Success!\",null,function(){e.back()},e)})})},e);return}Ext.Msg.show({title:\"Problem\",message:\"This order is not recognized\",promptConfig:false,buttons:[{text:\"Go back\",itemId:\"back\"},{text:\"Try again\",ui:\"action\",itemId:\"tryagain\"}],fn:function(g){if(g==\"back\"){e.back()}}})},onWebOrder:function(){var a=function(e){var b=this.locationsWithProperties([{key:\"web_url\",value:e},{key:\"end_datetime\",value:null},{key:\"pickup\",value:\"True\"}]);if(b.length>0){var c=b[0];c.end_datetime=this.formattedDate();console.log(c);Ext.Msg.alert(\"Success!\");return}b=this.locationsWithProperties([{key:\"web_url\",value:e},{key:\"delivery\",value:\"True\"}]);if(b.length>0){var d=Ext.create(\"Aporo.view.activeDG.CheckPackageModal\"),c=b[0];Ext.Viewport.add(d);Ext.getCmp(\"checkPackageModalSubmitButton\").on(\"tap\",function(){var f=Ext.getCmp(\"checkPackageModalPriceField\").getValue(),g=Ext.getCmp(\"checkPackageModalTipField\").getValue();d.destroy();c.price=f;c.tip=g;c.end_datetime=this.formattedDate();console.log(c);Ext.Msg.alert(\"Success!\")},this);return}Ext.Msg.show({title:\"Problem\",message:\"This order is not recognized\",promptConfig:false,buttons:[{text:\"Cancel\",itemId:\"back\"},{text:\"Try again\",ui:\"action\",itemId:\"tryagain\"}],scope:this,fn:function(f){if(f==\"tryagain\"){var g=this;setTimeout(function(){g.onWebOrder()},500)}}})};a.call(this,\"url\")},formattedDate:function(){function a(c){function b(d){return d<10?\"0\"+d:d}return c.getUTCFullYear()+\"-\"+b(c.getUTCMonth()+1)+\"-\"+b(c.getUTCDate())+\"T\"+b(c.getUTCHours())+\":\"+b(c.getUTCMinutes())+\":\"+b(c.getUTCSeconds())+\"Z\"}return a(new Date())},nextLocation:function(){var c=null;if(!this.locations){return c}for(var a=0;a<this.locations.length;a++){var b=this.locations[a][\"end_datetime\"];if(!b||b==\"\"){if(c){if(parseInt(c.loc_num)>parseInt(this.locations[a][\"loc_num\"])){c=this.locations[a]}}else{c=this.locations[a]}}}return c},locationsForTag:function(b){var a=[];if(!this.locations){return a}for(var c=0;c<this.locations.length;c++){if(this.locations[c][\"tag\"]==b){a.push(this.locations[c])}}return a},locationsWithProperties:function(e){var a=[];if(!this.locations){return a}for(var d=0;d<this.locations.length;d++){var f=true;for(var b=0;b<e.length;b++){var c=e[b][\"key\"],g=e[b][\"value\"];if(!g){if(this.locations[d][c]&&this.locations[d][c]!=\"\"){f=false}}else{if(g==\"True\"){if(this.locations[d][c]===false||this.locations[d][c]==\"false\"||!this.locations[d][c]){f=false}}else{if(this.locations[d][c]!=g){f=false}}}}if(f){a.push(this.locations[d]);break}}return a},titleForLocation:function(a){var b=null;if(a.addr){b=a.addr}if(a.cross_street){b=(b&&b.length>0)?b+\", \"+a.cross_street:a.cross_street}if(a.tag){b=(b&&b.length>0)?b+\", \"+a.tag:a.tag}return b",598346,34,"ActiveDG",599439,41,"PassiveDG",598447,36,"PassiveDGMainView:\"PassiveDGMainView\",PassiveDGMenuView:\"PassiveDGMenuView\",PassiveDGContracts:\"PassiveDGContracts\",PassiveDGHistory:\"PassiveDGHistory\"},control:{PassiveDGMainView:{activate:\"onActivate\"},\"PassiveDGMainView #findWorkButton\":{tap:\"onFindWork\"},\"PassiveDGMainView #checkInNowButton\":{tap:\"onCheckInNow\"},\"PassiveDGMainView #btnContracts\":{tap:\"onContracts\"},\"PassiveDGMainView #btnCheckIn\":{tap:\"onCheckIn\"},\"PassiveDGMainView #btnHistory\":{tap:\"onHistory\"},PassiveDGContracts:{activate:\"onContractsActivate\"}}},slideLeftTransition:{type:\"slide\",direction:\"left\"},slideRightTransition:{type:\"slide\",direction:\"right\"},work:null,contracts:null,contractsStore:null,onActivate:function(){console.log(\"# onActivate\");this.getWorkJSON();this.getPassiveDGMainView().setMasked({xtype:\"loadmask\"})},back",600576,44,"FindWork:function(){this.back()},onCheckInNow:function(){Ext.Msg.confirm(\"Are you sure?\",\"Are you sure you want to check-in now?\",function(a){if(a==\"yes\"){this.back()}},this)},onContracts",600576,35,598219,44,"Contracts",600302,54,"passiveDG.Contracts\"))},onCheckIn:function(){this.back()},onHistory",600576,35,598219,44,600295,61,"passiveDG.History\"))},getWorkJSON:function(){console.log(\"# getWorkJSON\");var a=this",600926,52,"api/work/",596178,41,"params:Ext.encode({action:\"GET\",currier_id:Aporo.config.Env.currier_id}),success:function(b){var c=Ext.decode(b.responseText);a.updateWorkJSON(c);a.getPassiveDGMainView().setMasked(false)},failure:function(b){Ext.Msg.alert(\"Error\",\"There was a problem fetching Work.JSON\");a.back()}})},updateWorkJSON:function(a){console.log(\"# updateWorkJSON\",a);this.work=a;Aporo.util.PhoneGap.saveFile({fileName:\"Work.JSON\",data:a,success:function(){console.log(\"Work.JSON saved\")},failure:function(b){Ext.Msg.alert(\"Error saving Work.JSON\",b.code)}});this.updateHeader()},updateHeader:function(){var i=this.nextWork(),h=Ext.getCmp(\"PassiveDGMenuView\"),d=h.getComponent(\"header\"),a=h.getComponent(\"findWorkButton\"),c=h.getComponent(\"checkInNowButton\");if(this.hasWork()){a.hide();c.hide();var f=Date.parse(i.start_datetime);if(Date.now()>=(f-900000)){d.hide();c.show();return}else{var g=new Date(),b=new Date(Date.parse(i.start_datetime)),e=g.toDateString()==b.toDateString();d.setHtml([\"Next Check In:\",e?\"TODAY\":i.start_day,i.start_time,i.area].join(\"<br />\"))}}else{d.hide();c.hide();a.show()}},getContractsJSON:function(){console.log(\"# getContractsJSON\");var a=this",600926,52,"api/dg_contracts/",596178,41,"params:Ext.encode({action:\"GET\",currier_id:Aporo.config.Env.currier_id}),success:function(b){var c=Ext.decode(b.responseText);a.contractsStore=Ext.create(\"Ext.data.Store\",{storeId:\"contractsStore\",fields:[\"area\",\"contract_id\",\"hour_period\",\"start_datetime\",\"start_day\",\"start_time\",\"curriers\",{name:\"registered\",convert:function(g,d){var h=false,f=d.get(\"curriers\");for(var e=0;e<f.length;e++){if(f[e].currier_id==Aporo.config.Env.currier_id){h=true;break}}return h}}],data:c});a.getPassiveDGContracts().setStore(a.contractsStore)},failure:function(b){Ext.Msg.alert(\"Error\",\"There was a problem fetching Contracts.JSON\");a.back()}})},onContractsActivate:function(){this.getContractsJSON()},nextWork:function(){var b=null;if(!this.work||!this.work.dg_schedule||this.work.dg_schedule.length==0){return b}var d=this.work.dg_schedule;for(var a=0;a<d.length;a++){var c=d[a][\"check_in_datetime\"];if(!c||c==\"\"||c==\"null\"){if(b){if(Date.parse(b.start_datetime)>Date.parse(d[a][\"start_datetime\"])){b=d[a]}}else{b=d[a]}}}return b},hasWork:function(){return this.work&&this.work.dg_schedule&&this.work.dg_schedule.length>0",598346,34,"PassiveDG",596018,234,"api_view",596252,130,601396,4799,"(Ext.cmd.derive(\"Aporo.view.activeDG.MenuView",603487,33,"card\",scrollable:null,items:[{xtype:\"toolbar\",docked:\"top\",itemId:\"toolbarHeader\"},{flex:1,layout:{pack:\"center\",type:\"vbox\"},items:[{xtype:\"button\",text:\"Check Package\",itemId:\"btnCheckPackage\",ui:\"action\",margin:\"2% 15% 0 15%\"},{xtype:\"button\",text:\"Update Route\",itemId:\"btnUpdateRoute\",ui:\"action\",margin:\"2% 15% 0 15%\"},{xtype:\"button\",text:\"Check-out\",itemId:\"btnCheckOut\",ui:\"action\",margin:\"2% 15% 0 15%\"}]}]}},0,[\"ActiveDGMenuView\"],[\"ActiveDGMenuView\",\"component\",\"container\"],{ActiveDGMenu",603311,39,"},[\"widget.ActiveDGMenuView\"],0,[Aporo.view.activeDG,\"Menu",603433,39,"activeDG.MainView\",Ext.Container,{id:\"ActiveDGMainView\",config:{layout:\"card\",items:[{itemId:\"ActiveDGMenuView\",xtype:\"ActiveDGMenuView\",flex:1}]}},0,[\"ActiveDGMainView\"],[\"ActiveDGMainView\",\"component\",\"container\"],{ActiveDGMai",603310,40,"},[\"widget.ActiveDGMainView\"],0,[Aporo.view.activeDG,\"Mai",603432,40,"activeDG.CheckPackage\",Ext.Container,{id:\"ActiveDGCheckPackage\",config:{layout:\"card\",scrollable:null,items:[{xtype:\"formpanel\",items:[{xtype:\"textfield\",label:\"Tag\",itemId:\"tagField\"},{xtype:\"titlebar\",docked:\"bottom",605769,39,"align:\"right\",itemId:\"submitButton\"}]}]}]}},0,[\"ActiveDGCheckPackage\"],[\"ActiveDGCheckPackage\",\"component\",\"container\"],{ActiveDGCheckPackage",604763,46,"ActiveDGCheckPackage\"],0,[Aporo.view.activeDG,\"CheckPackage",601821,35,"activeDG.CheckPackageModal\",Ext.Panel,{id:\"ActiveDGCheckPackageModal\",config:{scrollable:null,modal:true,centered:true,items:[{xtype:\"fieldset\",items:[{xtype:\"textfield\",label:\"Price\",id:\"checkPackageModalPriceField\"},{xtype:\"textfield\",label:\"Tip\",id:\"checkPackageModalTipField\"}]},",570305,32,605770,38,"id:\"checkPackageModalSubmitButton\"}]}]}},0,[\"ActiveDGCheckPackageModal\"],[\"ActiveDGCheckPackageModal\",",278050,34,"ActiveDGCheckPackageModal",604763,35,",panel:true},[\"widget.ActiveDGCheckPackageModal\"],0,[Aporo.view.activeDG,\"CheckPackageModal",601821,35,"passiveDG.MenuView\",Ext.Container,{id:\"PassiveDGMenuView\",config:{layout:\"card\",scrollable:null,items:[{xtype:\"container\",docked:\"top\",itemId:\"header\",margin:\"2% 15% 0 15%\"},{xtype:\"button\",docked:\"top\",text:\"Find Work Now!\",itemId:\"findWorkButton\",margin:\"2% 15% 0 15%\"},{xtype:\"button\",docked:\"top\",text:\"Check In Now\",itemId:\"checkInNowButton\",margin:\"2% 15% 0 15%\"},{flex:1,layout:{pack:\"center\",type:\"vbox\"},items:[{xtype:\"button\",text:\"Contracts\",itemId:\"btnContracts\",ui:\"action\",margin:\"2% 15% 0 15%\"},{xtype:\"button\",text:\"Check-in\",itemId:\"btnCheckIn\",ui:\"action\",margin:\"2% 15% 0 15%\"},{xtype:\"button\",text:\"History\",itemId:\"btnHistory\",ui:\"action\",margin:\"2% 15% 0 15%\"}]}]}},0,[\"PassiveDGMenuView\"],[\"PassiveDGMenuView\",\"component\",\"container\"],{PassiveDGMenu",603311,39,"},[\"widget.PassiveDGMenuView\"],0,[Aporo.view.passiveDG,\"Menu",603433,39,"passiveDG.MainView\",Ext.Container,{id:\"PassiveDGMainView\",config:{layout:\"card\",items:[{id:\"PassiveDGMenuView\",itemId:\"PassiveDGMenuView\",xtype:\"PassiveDGMenuView\",flex:1}]}},0,[\"PassiveDGMainView\"],[\"PassiveDGMainView\",\"component\",\"container\"],{PassiveDGMai",603310,40,"},[\"widget.PassiveDGMainView\"],0,[Aporo.view.passiveDG,\"Mai",603432,40,"passiveDG.Contracts\",Ext.Container,{id:\"PassiveDGContracts\",config:{store:null,layout:\"card\",items:[",570305,32,",items:[{xtype:\"spacer\"},{xtype:\"button\",text:\"Update\"},{xtype:\"spacer\"}]},{xtype:\"grid\",titleBar:false,columns:[{xtype:\"checkcolumn\",text:\"Registered?\",dataIndex:\"registered\",width:120},{text:\"Day\",dataIndex:\"start_day\",width:150},{text:\"Time\",dataIndex:\"start_time\",width:100},{text:\"Area\",dataIndex:\"area\",width:200}]}]},updateStore:function(a){this.down(\"grid\").setStore(a)}},0,[\"PassiveDGContracts\"],[\"PassiveDGContracts\",\"component\",\"container\"],{PassiveDGContracts",604763,46,"PassiveDGContracts\"],0,[Aporo.view.passiveDG,\"Contract",601360,36,"passiveDG.History\",Ext.Container,{id:\"PassiveDGHistory\",config:{}},0,[\"PassiveDGHistory\"],[\"PassiveDG",604715,35,"PassiveDG",604756,53,"PassiveDGHistory\"],0,[Aporo.view.passiveDG,\"History",606188,104,",\"Aporo.util.PhoneGap",606291,100,",\"activeDG.MainView\",\"activeDG.MenuView\",\"activeDG.CheckPackage\",\"activeDG.CheckPackageModal\",\"passiveDG.MainView\",\"passiveDG.MenuView\",\"passiveDG.Contracts\",\"passiveDG.History",606390,57,",\"ActiveDG\",\"PassiveDG",606446,570,"Ajax.setUseDefaultXhrHeader(false);",607012,294]